<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>JavaScripté–¢æ•°å•é¡Œ 100æœ¬ãƒãƒƒã‚¯</title>
</head>

<body>
    <p>JavaScript100æœ¬ãƒãƒƒã‚¯</p>
    <h1 id="question"></h1>
    <div class="container" id="editor" style="height: 300px"></div>
    <div class="choice">
        <label class="choice-label">
            <input type="radio" name="ansewer" value="0">
            1
        </label>
        <label class="choice-label">
            <input type="radio" name="ansewer" value="1">
            2
        </label>
        <label class="choice-label">
            <input type="radio" name="ansewer" value="2">
            3
        </label>
    </div>
    <div class="button-container">
        <button onclick="checkAnswer()">å›ç­”</button>
        <button id="next-button" onclick="nextQuestion()">æ¬¡ã®å•é¡Œ</button>
        <button id="review-button" data-count="0"><a href="review.html" target="_blank">å¾©ç¿’ã™ã‚‹</a></button>
        <button id="delete-all" onclick="resetAll()">å…¨ã¦ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div id="message"></div>
    <div id="statistics">
        <!-- ã“ã“ã«æ­£ç­”ç‡ã‚’è¡¨ç¤º -->
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.js"></script>
    <!-- Monaco Editorèª­ã¿è¾¼ã¿ -->
    <script>
        require.config({
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs'
            }
        });

        require(['vs/editor/editor.main'], function () {
            // ã‚¨ãƒ‡ã‚£ã‚¿ã®åˆæœŸåŒ–
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: allQuestions[0].choices.join('\n\n'), //\nã§æ”¹è¡Œ
                language: 'javascript',
                theme: 'vs-dark', // ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã‚’ä½¿ç”¨
                minimap: { enabled: false }, // ãƒŸãƒ‹ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º
                lineNumbers: 'on',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                readOnly: true, //èª­ã¿å–ã‚Šå°‚ç”¨
                fontSize: 14,
                tabSize: 2,
                automaticLayout: true // ã‚³ãƒ³ãƒ†ãƒŠã®ãƒªã‚µã‚¤ã‚ºã«å¯¾å¿œ
            });
            $("#question").text(allQuestions[0].question); //åˆæœŸã®ãƒ©ãƒ³ãƒ€ãƒ å–å¾—ãŒã†ã¾ãã„ã‹ãªã„ãŸã‚æœ€åˆã®å•é¡Œã¯å›ºå®š
            initializeQuestions(); // åˆæœŸåŒ–
            console.log("ã‚¨ãƒ‡ã‚£ã‚¿åˆæœŸåŒ–å¾Œã®æ®‹ã‚Šå•é¡Œæ•°:", remainingQuestions.length);
        });

        function checkAnswer() {
            const selectedAnswer = $('input[name="ansewer"]:checked');//ã€Œã©ã®ã€é¸æŠè‚¢ã‚’âœ“ã—ãŸã‹
            if (!selectedAnswer) {
                $('#message').text('è§£ç­”ã‚’é¸æŠã—ã¦ãã ã•ã„').css('color', '#f44336');
                return;
            }
            //æ­£è§£ã ã£ãŸã‚‰isCorrectã«
            const isCorrect = parseInt(selectedAnswer.val()) === allQuestions[currentQuestionIndex].correctIndex;//parsIntã§æ•°å€¤ã«å¤‰æ›ï¼ˆãªãã¦ã‚‚==å¯ï¼‰
            let studyData = JSON.parse(localStorage.getItem("studyData")) || { //1å•ã‚‚ç­”ãˆã¦ãªã„ã¨ãã¯nullãªã®ã§||ä»¥é™ã®åˆæœŸå€¤ãŒå…¥ã‚‹
                totalAnswered: 0,
                correctAnswers: 0,
                wrongQuestions: [] //ç¾çŠ¶é‡è¤‡ã—ã¦æŒ¿å…¥ã•ã‚Œã‚‹â†’é‡è¤‡ã‚’å‰Šé™¤ã—ã¦ã€ãã®å‰Šé™¤ã—ãŸåˆ†totalAnswered--;ã—ãŸã„
            };

            studyData.totalAnswered++; //å›ç­”æ¸ˆã¿ç·æ•°ã‚’å¢—ã‚„ã™

            if (isCorrect) {
                studyData.correctAnswers++;
                $('#message').text('æ­£è§£ï¼ğŸŒ¸').css('color', '#4caf50');
            } else {//èª¤ã£ãŸå•é¡Œã®å ´åˆã®å‡¦ç†ï¼ˆé‡è¤‡ã—ã¦ã„ãªã‘ã‚Œã°è¿½åŠ ã™ã‚‹ï¼‰
                if (!studyData.wrongQuestions.includes(currentQuestionIndex)) {
                    studyData.wrongQuestions.push(currentQuestionIndex);
                } else {//é‡è¤‡ã—ã¦ã„ãŸã‚‰totalAnsweredã‚‚1ãƒã‚¤ãƒŠã‚¹
                    studyData.totalAnswered--;
                }
                $('#message').text('æ®‹å¿µï¼ã‚‚ã†ä¸€å›æŒ‘æˆ¦ã—ã‚ˆï¼').css('color', '#f44336');
            }
            $('#review-button').attr('data-count', studyData.wrongQuestions.length); //é€šçŸ¥ã®æ•°å­—ã‚’æ›´æ–°ã™ã‚‹ãŸã‚
            localStorage.setItem("studyData", JSON.stringify(studyData)); //localStorageã«ä¿å­˜ã™ã‚‹ãŸã‚æ–‡å­—åˆ—ã«å¤‰æ›

            const correctRate = ((studyData.correctAnswers / studyData.totalAnswered) * 100).toFixed(1); //å°æ•°ç‚¹ãªã—
            $("#statistics").text(`æ­£è§£ç‡ï¼š${correctRate}%`);
        }

        //æœªå‡ºé¡Œå•é¡Œã®é…åˆ—
        let remainingQuestions = [];
        function initializeQuestions() {
            //ä¸€æ—¦å…¨éƒ¨å…¥ã‚Œã‚‹
            remainingQuestions = Array.from({ length: allQuestions.length }, (_, i) => i); //å•é¡Œå…¨ã¦ã«é…åˆ—ç•ªå·ã‚’ä»˜ä¸ã™ã‚‹
            console.log("åˆæœŸåŒ–æ™‚ã®æ®‹ã‚Šå•é¡Œæ•°:", remainingQuestions.length);
        }
        function nextQuestion() {
            const isAnswered = $('input[name="ansewer"]:checked').length > 0;//é¸æŠè‚¢ã®âœ“æœ‰ç„¡ã‚’ç¢ºèª
            // æœªå›ç­”ã®å ´åˆ
            if (!isAnswered) {
                $('#message').text('è§£ç­”ã‚’é¸æŠã—ã¦ãã ã•ã„').css('color', '#f44336');
                return;
            }
            console.log("nextQuestioné–‹å§‹æ™‚ã®æ®‹ã‚Šå•é¡Œæ•°:", remainingQuestions.length);
            //æœªå‡ºé¡ŒãŒ0ã«ãªã£ãŸã‚‰ã‚‚ã†ä¸€å›å…¨éƒ¨ã‚»ãƒƒãƒˆã™ã‚‹
            if (remainingQuestions.length === 0) {
                initializeQuestions();
                $('#message').text('å…¨å•é¡Œã‚’ä¸€å‘¨ã—ã¾ã—ãŸï¼ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼');
            }
            //ãƒ©ãƒ³ãƒ€ãƒ ã«æœªå‡ºé¡Œå•é¡Œã‚’é¸ã¶
            const randomIndex = Math.floor(Math.random() * remainingQuestions.length);
            const questionIndex = remainingQuestions[randomIndex];

            //é¸ã‚“ã å•é¡Œã‚’æœªå‡ºé¡Œãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã€€â€»ã“ã‚ŒãŒå¤§äº‹ï¼ï¼ï¼ï¼
            remainingQuestions.splice(randomIndex, 1);
            console.log("å•é¡Œé¸æŠå¾Œã®æ®‹ã‚Šå•é¡Œæ•°:", remainingQuestions.length);

            //å•é¡Œæ–‡ã€ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼éƒ¨åˆ†ã€é¸æŠè‚¢ã‚’æ›´æ–°ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã¯å‰Šé™¤ï¼‰
            currentQuestionIndex = questionIndex;
            const nextQuestion = allQuestions[questionIndex];
            $("#question").text(nextQuestion.question);
            editor.setValue(nextQuestion.choices.join('\n\n'));
            $("input[name='ansewer']").prop('checked', false);
            $("#message").text("");
        }

        function resetAll() {
            localStorage.clear();
            initializeQuestions();
            $("#message").text("");
            $("#statistics").text("");
            $("input[name='ansewer']").prop('checked', false); // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®é¸æŠã‚’è§£é™¤
            $('#review-button').attr('data-count', '0');
            // æœ€åˆã®çŠ¶æ…‹ã‚’è¡¨ç¤º
            currentQuestionIndex = 0;
            $("#question").text(allQuestions[0].question);
            editor.setValue(allQuestions[0].choices.join('\n\n'));
        }

        //åˆæœŸåŒ–ï¼ˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œï¼‰
        document.addEventListener('DOMContentLoaded', function () {
            //å•é¡Œã®åˆæœŸåŒ–
            initializeQuestions();

            //é€šçŸ¥ãƒãƒƒã‚¸ã®åˆæœŸåŒ–
            let studyData = JSON.parse(localStorage.getItem("studyData")) || {
                totalAnswered: 0,
                correctAnswers: 0,
                wrongQuestions: []
            };
            $('#review-button').attr('data-count', studyData.wrongQuestions.length);

            //ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã®æ­£ç­”ç‡ï¼ˆlocalStorageãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã¯è¡¨ç¤ºï¼‰
            if (studyData.totalAnswered > 0) {
                const correctRate = ((studyData.correctAnswers / studyData.totalAnswered) * 100).toFixed(1);
                $("#statistics").text(`æ­£è§£ç‡ï¼š${correctRate}%`);
            }
        });
    </script>
</body>

</html>