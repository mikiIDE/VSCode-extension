<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>é–“é•ã£ãŸå•é¡Œä¸€è¦§</title>
</head>

<body>
    <p>å¾©ç¿’éƒ¨å±‹</p>
    <h1 id="question"></h1>
    <div class="container" id="editor" style="height: 300px">
        <!-- ã“ã“ã«èª¤ã£ãŸå•é¡Œã‚’è¡¨ç¤ºã™ã‚‹ -->
    </div>
    <div class="choice">
        <label class="choice-label">
            <input type="radio" name="ansewer" value="0">
            1
        </label>
        <label class="choice-label">
            <input type="radio" name="ansewer" value="1">
            2
        </label>
        <label class="choice-label">
            <input type="radio" name="ansewer" value="2">
            3
        </label>
    </div>
    <div class="button-container">
        <button onclick="checkAnswer()">å®Ÿè¡Œ</button>
        <button id="next-button" onclick="nextWrongQuestion()">æ¬¡ã®å•é¡Œ</button>
        <button id="delete-button" onclick="deleteQuestion()">å‰Šé™¤</button>
    </div>
    <div id="message"></div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.js"></script>
    <!-- Monaco Editorèª­ã¿è¾¼ã¿ -->
    <script>
        require.config({
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs'
            }
        });

        require(['vs/editor/editor.main'], function () {
            //ã‚¨ãƒ‡ã‚£ã‚¿ã®åˆæœŸåŒ–
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: '', //åˆæœŸå€¤ã¯ç©º
                language: 'javascript',
                theme: 'vs-dark',
                minimap: { enabled: false },
                lineNumbers: 'on',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                readOnly: true,
                fontSize: 14,
                tabSize: 2,
                automaticLayout: true
            });

            //åˆæœŸåŒ–
            initializeWrongQuestions();
        });

        let wrongQuestions = []; //é–“é•ãˆãŸå•é¡Œ
        let currentWrongIndex = 0; //ç¾åœ¨è¡¨ç¤ºã—ã¦ã„ã‚‹å•é¡Œï¼ˆèª¤ã£ãŸå•é¡Œã®1å•ç›®ï¼‰

        function initializeWrongQuestions() {
            //localStorageã‹ã‚‰é–“é•ãˆãŸå•é¡Œã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆæ–‡å­—åˆ—â†’ãƒ‡ãƒ¼ã‚¿ã¸å¤‰æ›ï¼‰
            const studyData = JSON.parse(localStorage.getItem('studyData')) || {}; //ãªã‘ã‚Œã°null(ç©ºæ¬„)
            wrongQuestions = studyData.wrongQuestions || []; //åŒä¸Š

            if (wrongQuestions.length > 0) {
                //æœ€åˆã®é–“é•ãˆãŸå•é¡Œã‚’è¡¨ç¤º
                displayWrongQuestion(0);
            } else {//ãªã‘ã‚Œã°è¤’ã‚
                $("#message").text("é–“é•ãˆãŸå•é¡ŒãƒŠã‚·ï¼ç´ æ™´ã‚‰ã—ã„ï¼ï¼").css('color', '#4caf50');
            }
        }
        //é–“é•ãˆãŸå•é¡ŒãŒã‚ã‚Œã°
        function displayWrongQuestion(index) {//index=èª¤ã£ãŸå•é¡Œã®ç•ªå·
            if (index >= 0 // && index < wrongQuestions.length
            ) {
                const questionIndex = wrongQuestions[index]; //æŒ‡å®š
                const question = allQuestions[questionIndex]; //å…ƒãƒ‡ãƒ¼ã‚¿ï¼ˆå…¨ä½“ï¼‰ã‹ã‚‰æ¢ã—å‡ºã™

                $("#question").text(question.question);
                editor.setValue(question.choices.join('\n\n'));
                $("input[name='ansewer']").prop('checked', false);
                $("#message").text("");

                currentWrongIndex = index;
            }
        }

        function checkAnswer() {
            const selectedAnswer = $('input[name="ansewer"]:checked');//ã©ã®é¸æŠè‚¢ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‹ã‹ï¼Ÿã‚‚ã“ã“ã§ç¢ºèª
            if (!selectedAnswer.length) {
                $('#message').text('è§£ç­”ã‚’é¸æŠã—ã¦ãã ã•ã„').css('color', '#f44336');
                return;
            }

            const questionIndex = wrongQuestions[currentWrongIndex];
            const isCorrect = parseInt(selectedAnswer.val()) === allQuestions[questionIndex].correctIndex;

            if (isCorrect) {
                $('#message').text('æ­£è§£ï¼ğŸŒ¸').css('color', '#4caf50');
            } else {
                $('#message').text('æ®‹å¿µï¼ã‚‚ã†ä¸€å›æŒ‘æˆ¦ã—ã‚ˆï¼').css('color', '#f44336');
            }
        }

        function nextWrongQuestion() {
            if (currentWrongIndex < wrongQuestions.length - 1) {
                displayWrongQuestion(currentWrongIndex + 1);
            } else {
                $("#message").text("ã‚ªãƒ¼ãƒ«ã‚¯ãƒªã‚¢ï¼").css('color', '#4caf50');
            }
        }

        function deleteQuestion() {
            if (wrongQuestions.length > 0) {
                //ç¾åœ¨ã®å•é¡Œã‚’é…åˆ—ã‹ã‚‰å‰Šé™¤
                wrongQuestions.splice(currentWrongIndex, 1);

                //localStorageã‚’æ›´æ–°
                const studyData = JSON.parse(localStorage.getItem('studyData')) || {};
                studyData.wrongQuestions = wrongQuestions;//ãƒãƒªãƒ¥ãƒ¼ã¯wrongQuestionï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
                localStorage.setItem('studyData', JSON.stringify(studyData)); //ã‚­ãƒ¼ã‚’studyDataã«æŒ‡å®š

                if (wrongQuestions.length > 0) {
                    //æ¬¡ã®å•é¡Œã‚’è¡¨ç¤ºï¼ˆã¾ãŸã¯åŒã˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§æ¬¡ã®å•é¡Œï¼‰
                    displayWrongQuestion(Math.min(currentWrongIndex, wrongQuestions.length - 1));
                } else {
                    $("#message").text("ã‚ªãƒ¼ãƒ«ã‚¯ãƒªã‚¢ï¼").css('color', '#4caf50');
                    editor.setValue('');
                    $("#question").text('');
                }
            }
        }

    </script>
</body>

</html>